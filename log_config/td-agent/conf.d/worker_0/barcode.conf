#
# This conf was generated by the ansible playbook template
# Every manual change will be overwrited by the ansible playbook
# https://github.com/8x8/auto_ansible_roles_service-fluentd
#

<source>
    @type tail
    @id in_barcode_1
    <parse>
    @type multiline
        format_firstline /\[.*\]\d\d\d\d/
        format1 /(?<message>.*)/
        localtime
    </parse>
    path /root/.pyenv/versions/3.10.9/lib/python3.10/site-packages/barcode_service/barcode.log
    pos_file /var/lib/fluent_oci_outplugin/pos/barcode.log1.pos
    read_from_head false
    enable_watch_timer true
    enable_stat_watcher false
    tag oci.0.8x8.barcode.log.*
</source>


<filter oci.0.8x8.barcode.**>
        @type record_transformer
        enable_ruby true
        <record>
                oci_la_metadata ${{'Host Name (Client)':"#{hostname || 'UNKNOWN'}", 'Host IP Address (Client)':"IP_ADDRESS_UNKNOWN", 'Environment':"BARCODE"}}
                oci_la_log_group_id "ocid1.loganalyticsloggroup.oc1.us-sanjose-1.amaaaaaaj6gjizaaapq6cmowa6j2eatnvf7kmq3yv2ej4uzafo4ndbqpisuq"
                oci_la_log_path ${tag}
                oci_la_log_source_name "BARCODE"
                tag ${tag}
        </record>
</filter>

<match oci.0.8x8.barcode.**>
       @type copy
       <store>
              @type oci-logging-analytics
              namespace                 idxixi5bmstw
              config_file_location      /var/lib/td-agent/.oci/config
              profile_name              DEFAULT
              plugin_log_location       /var/log/fluent_oci_outplugin/logs/
              plugin_log_level          info
              plugin_log_file_size      1MB
              plugin_log_file_count     10
             <buffer>
                  @type file
                  path /var/log/fluent_oci_outplugin/buffer/0/barcode/
                  disable_chunk_backup true
                  flush_thread_count 4
             </buffer>
       </store>
       <store>
            @type flowcounter
            @id flowcounter_agg_0_barcode
            @label @counts_0
            tag worker.0
            count_keys message
            aggregate all
            unit minute
       </store>
</match>
